<!DOCTYPE html>  <html> <head>   <title>container_spec.js.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               container_spec.js.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <h2>core.Container</h2>

<p>A lightweight dependency injection container.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">describe</span> <span class="s">&quot;core.Container&quot;</span><span class="p">,</span> <span class="o">-&gt;</span>

    <span class="nv">container = </span><span class="kc">null</span>
    <span class="nv">User = </span><span class="k">class</span>
    <span class="nv">some_instance = </span><span class="k">new</span> <span class="nx">MyClass</span>
    

    <span class="nx">beforeEach</span> <span class="o">-&gt;</span>
        <span class="nv">container = </span><span class="k">new</span> <span class="nx">core</span><span class="p">.</span><span class="nx">Container</span>
        </pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <h2>constructor</h2>

<p>Creates an instance of a container.  When given a <code>parent</code> container, then if resolution of a
dependency fails the resolution will be attempted with the parent container instead.</p>

<p>params:</p>

<ul>
<li><code>parent</code>: (optional): the parent container</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>    
    <span class="nx">describe</span> <span class="s">&quot;constructor&quot;</span><span class="p">,</span> <span class="o">-&gt;</span>
        
        <span class="nx">it</span> <span class="s">&quot;creates an instance of a Container, with an optional parent container&quot;</span><span class="p">,</span> <span class="o">-&gt;</span>
            <span class="nv">parent = </span><span class="k">new</span> <span class="nx">core</span><span class="p">.</span><span class="nx">Container</span>
            <span class="nv">container = </span><span class="k">new</span> <span class="nx">core</span><span class="p">.</span><span class="nx">Container</span><span class="p">(</span> <span class="nx">parent</span> <span class="p">)</span>
            
            <span class="nx">expect</span><span class="p">(</span><span class="nx">container</span><span class="p">.</span><span class="nx">parent</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span> <span class="nx">parent</span> <span class="p">)</span>
            </pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <h2>resolve</h2>

<p>Resolves a dependency according to the container mappings.</p>

<p>params:
* <code>dependency</code>: the dependency to resolve. May be either a string
* <code>parent</code>: (optional): the parent container</p>             </td>             <td class="code">               <div class="highlight"><pre>    
    <span class="nx">describe</span> <span class="s">&quot;resolve&quot;</span><span class="p">,</span> <span class="o">-&gt;</span>
    
        <span class="nx">it</span> <span class="s">&quot;resolves dependencies by name&quot;</span><span class="p">,</span> <span class="o">-&gt;</span>
        
        <span class="nx">it</span> <span class="s">&quot;resolves dependencies on an object&quot;</span><span class="p">,</span> <span class="o">-&gt;</span>
        </pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>For more on resolving instances and classes, see <a href="#register_class">register<em>class</a> and
<a href="#register_instance">register</em>instance</a></p>             </td>             <td class="code">               <div class="highlight"><pre>    
    <span class="nx">it</span> <span class="s">&quot;resolves registered instances&quot;</span><span class="p">,</span> <span class="o">-&gt;</span>
        <span class="nv">my_object = </span><span class="k">new</span> <span class="nb">Object</span>
        <span class="nx">container</span><span class="p">.</span><span class="nx">register_instance</span> <span class="s">&quot;object&quot;</span><span class="p">,</span> <span class="nx">my_object</span>
        
        <span class="nx">expect</span><span class="p">(</span> <span class="nx">container</span><span class="p">.</span><span class="nx">resolve</span> <span class="s">&quot;object&quot;</span> <span class="p">).</span><span class="nx">toBe</span> <span class="nx">my_object</span>
        
    <span class="nx">it</span> <span class="s">&quot;resolves registered classes&quot;</span><span class="p">,</span> <span class="o">-&gt;</span>
        <span class="k">class</span> <span class="nx">MyClass</span>
        <span class="nx">container</span><span class="p">.</span><span class="nx">register_class</span> <span class="s">&quot;MyClass&quot;</span><span class="p">,</span> <span class="nx">MyClass</span>
        
        <span class="nx">expect</span><span class="p">(</span> <span class="nx">container</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span> <span class="s">&quot;MyClass&quot;</span> <span class="p">)</span> <span class="k">instanceof</span> <span class="nx">MyClass</span> <span class="p">).</span><span class="nx">toBeTruthy</span><span class="p">()</span>
        
    <span class="nx">it</span> <span class="s">&quot;resolves classes registered as singletons to the same instance&quot;</span><span class="p">,</span> <span class="o">-&gt;</span>
        <span class="k">class</span> <span class="nx">MyClass</span>
        <span class="nx">container</span><span class="p">.</span><span class="nx">register_class</span> <span class="s">&quot;MyClass&quot;</span><span class="p">,</span> <span class="nx">MyClass</span><span class="p">,</span> <span class="nv">singleton: </span><span class="kc">true</span>
        
        <span class="nx">expect</span><span class="p">(</span> <span class="nx">container</span><span class="p">.</span><span class="nx">resolve</span> <span class="s">&quot;MyClass&quot;</span> <span class="p">).</span><span class="nx">toBe</span><span class="p">(</span> <span class="nx">container</span><span class="p">.</span><span class="nx">resolve</span> <span class="s">&quot;MyClass&quot;</span> <span class="p">)</span>        
        
    <span class="nx">it</span> <span class="s">&quot;resolves nested dependencies&quot;</span><span class="p">,</span> <span class="o">-&gt;</span>
        <span class="k">class</span> <span class="nx">MyClass</span> <span class="k">extends</span> <span class="nx">core</span><span class="p">.</span><span class="nx">DependentObject</span>
            <span class="nx">@dependency</span> <span class="nv">object: </span><span class="s">&quot;object&quot;</span>
            
        <span class="nv">my_object = </span><span class="k">new</span> <span class="nb">Object</span>

        <span class="nx">container</span><span class="p">.</span><span class="nx">register_instance</span> <span class="s">&quot;object&quot;</span><span class="p">,</span> <span class="nx">my_object</span>
        <span class="nx">container</span><span class="p">.</span><span class="nx">register_class</span> <span class="s">&quot;MyClass&quot;</span><span class="p">,</span> <span class="nx">MyClass</span>
        
        <span class="nv">my_instance = </span><span class="nx">container</span><span class="p">.</span><span class="nx">resolve</span> <span class="s">&quot;MyClass&quot;</span>
        
        <span class="nx">expect</span><span class="p">(</span> <span class="nx">my_instance</span> <span class="k">instanceof</span> <span class="nx">MyClass</span> <span class="p">).</span><span class="nx">toBeTruthy</span><span class="p">()</span>
        <span class="nx">expect</span><span class="p">(</span> <span class="nx">my_instance</span><span class="p">.</span><span class="nx">object</span> <span class="p">).</span><span class="nx">toBe</span> <span class="nx">my_object</span>

    <span class="nx">it</span> <span class="s">&quot;should resolve dependencies defined by deferred functions&quot;</span><span class="p">,</span> <span class="o">-&gt;</span>
        <span class="k">class</span> <span class="nx">MyClass</span> <span class="k">extends</span> <span class="nx">core</span><span class="p">.</span><span class="nx">DependentObject</span>
            <span class="nx">@dependency</span> <span class="nv">object: </span><span class="o">-&gt;</span> <span class="nx">my_object</span>
            
        <span class="nv">my_object = </span><span class="k">new</span> <span class="nb">Object</span>
        
        <span class="nx">container</span><span class="p">.</span><span class="nx">register_instance</span> <span class="s">&quot;object&quot;</span><span class="p">,</span> <span class="nx">my_object</span>
        <span class="nx">container</span><span class="p">.</span><span class="nx">register_class</span> <span class="s">&quot;MyClass&quot;</span><span class="p">,</span> <span class="nx">MyClass</span>
        
        <span class="nv">my_instance = </span><span class="nx">container</span><span class="p">.</span><span class="nx">resolve</span> <span class="s">&quot;MyClass&quot;</span>
        
        <span class="nx">expect</span><span class="p">(</span> <span class="nx">my_instance</span><span class="p">.</span><span class="nx">object</span> <span class="p">).</span><span class="nx">toBe</span> <span class="nx">my_object</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 